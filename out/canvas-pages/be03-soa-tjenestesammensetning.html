<h1 id="tjenestesammensetning">Tjenestesammensetning</h1>
<p>
  En trend de siste årene har vært et fokus på mikrotjenester, hvor vi splitter
  opp løsningene våre i veldig små biter for å lettere kunne utvikle løsninger.
  Det er en arkitektur for storskala løsninger og spesielt attraktivt/mye brukt
  når det er stor usikkerhet rundt hva som kreves for at bedriften skal være
  levedyktig.
</p>
<p>
  Vi skal se på en mikro utgave av dette mønsteret her med hjelp av Docker
  Compose.
</p>
<h2 id="teori">Teori</h2>
<h3 id="mikrotjenester">Mikrotjenester</h3>
<p>
  Mikrotjenester er et arkitekturmønster som beskriver løsninger hvor tjenestene
  er potensielt på størrelse med en KommentarTjeneste. Dette gjør det veldig
  lett og kjapt å eksperimentere, men alene er disse ikke nødvendigvis noe som
  en kan ta betalt for.
</p>
<p>
  Så verdien kommer først når du setter flere av disse sammen til et større
  produkt som en blogplatform, eller Learning Management System. Dette leder til
  at mye av kompleksiteten er flyttet fra individuelle programmer til
  orkestrering/sammensettingen av disse tjenestene til en løsning.
</p>
<h3 id="orkestrering-og-sammensetning">Orkestrering og sammensetning</h3>
<p>
  Det største og mest kjente løsningen for å definere disse
  tjenestesammensetningene er <a href="https://kubernetes.io/">Kubernetes</a>.
  Kubernetes er, potensielt, enormt stort og komplekst, og kommer fra Googles
  interne løsning (Borg) som de benytter for å administrere sine egne maskiner
  og produkter.
</p>
<p>
  Kort fortalt er Kubernetes et distribuert operativsystem, ment for å kjøre
  tjenester på flåter av maskiner (<a
    href="https://cloud.google.com/blog/products/containers-kubernetes/gke-65k-nodes-and-counting"
    >65,000+</a
  >).
</p>
<p>
  Vi holder oss relativt mye enklere og skal benytte oss av
  <a href="https://docs.docker.com/compose/">Docker Compose</a> for å sette opp
  våre egne komposisjoner som kan kjøres lokalt, og senere på en server. Docker
  Compose mangler mye av funksjonaliteten til Kubernetes, men det er lett å
  kjøre på sin egen maskin og gir et innblikk i, og muligheten for å teste,
  hvordan moderne systemer snakker sammen og hvordan en kan hente inn mange
  ferdige løsninger som benyttes i industrien (identitet, tilgangsstyring og
  database-løsninger vil være blant de nyttigste).
</p>
<h2 id="konkretisering">Konkretisering</h2>
<h3 id="hva-hvor-når-blir-dette-brukt">Hva, hvor, når blir dette brukt?</h3>
<p>
  Tjenestesammensetning vil bli brukt i de aller fleste løsninger. Eksakt
  hvordan dette gjøres varierer, og i markedet i dag florerer det av
  plattformløsninger som kan benyttes, hvor det operative ansvaret blir
  outsourcet til spesialiserte bedrifter og du sitter med en web-GUI eller
  web-API som du benytter deg av.
</p>
<h3 id="eksempler">Eksempler</h3>
<p><strong>Docker Compose - Nginx</strong>:</p>
<div class="sourceCode" id="cb1">
  <pre
    class="sourceCode yaml"
  ><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> single-service</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">web</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    # The repository (default hub.docker.io), name of container image along with the tag/version to use</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> nginx:alpine</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    # Ports are a list of mappings between host ports and container/app ports</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8080:80</span></span></code></pre>
</div>
<p><strong>Docker Compose - Lokal tjeneste</strong>:</p>
<div class="sourceCode" id="cb2">
  <pre
    class="sourceCode yaml"
  ><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> simpler-composition</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">api</span><span class="kw">:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    # Path to the Dockerfile and which context (directory) to build from</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./Api</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8080:5000</span></span></code></pre>
</div>
<p><strong>Docker Compose - Flere tjenester</strong>:</p>
<div class="sourceCode" id="cb3">
  <pre
    class="sourceCode yaml"
  ><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> simpler-composition</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">memory-service</span><span class="kw">:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./memory-service</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    # Ports are a limited resource, so you can&#39;t bind more than a single service to one</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8080:5000</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">inspirational-quote-service</span><span class="kw">:</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./inspirational-quote-service</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">      # Ports are a limited resource, so you can&#39;t bind more than a single service to one</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8081:5000</span></span></code></pre>
</div>
<h3 id="eksterne-lenker">Eksterne Lenker</h3>
<ul>
  <li>
    <a href="https://docs.docker.com/compose/">Docker Compose Documentation</a>
  </li>
</ul>
<h2 id="videre-lesing">Videre Lesing</h2>
<ul>
  <li>
    <a href="https://en.wikipedia.org/wiki/Service_composability_principle"
      >Wikipedia - Service Composability</a
    >
  </li>
</ul>
<h2 id="referanse-liste">Referanse Liste</h2>
<ul>
  <li>
    Docker Inc. (2024). <em>Docker Compose Documentation.</em> docs.docker.com.
  </li>
</ul>
